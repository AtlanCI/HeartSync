 # 双人异地同步观看视频网站设计方案 (MVP版本)

## 1. 核心功能

### 1.1 视频源支持
- 仅支持直接视频URL播放(mp4等格式)
- 使用HTML5原生video播放器
- 支持视频格式:mp4, webm, ogg

### 1.2 同步控制
- 基于WebSocket的实时通信
- 同步关键事件:
  - 播放/暂停状态变更
  - 视频进度跳转
  - 视频加载完成
- 消息格式:  ```json
  {
    "type": "play|pause|seek",
    "data": "进度位置或状态"
  }  ```

### 1.3 房间系统
- 6位数字房间码(100000-999999)
- 房间状态:
  - empty: 空房间
  - waiting: 一人等待中
  - full: 两人已满
- 房间信息存储在内存Map中

## 2. 技术方案

### 2.1 前端实现
- HTML + 原生JavaScript
- HTML5 video标签实现播放器
- WebSocket处理实时通信
- 最小化CSS样式

### 2.2 后端实现
- Go + Gin框架提供Web服务
- gorilla/websocket处理WebSocket连接
- 使用Map存储房间信息:  ```go
  map[string]*Room  // roomId -> Room对象  ```

### 2.3 数据结构
```go
// 房间对象
type Room struct {
    ID string // 房间ID
    VideoURL string // 视频URL
    Users []string // 用户列表,最多2个
    Status string // 房间状态
    CreatedAt time.Time // 创建时间
}
// WebSocket消息
type Message struct {
    Type string // 消息类型
    Data string // 消息数据
}
```

## 3. 核心流程

### 3.1 创建房间
1. 生成随机6位数房间码
2. 创建Room对象并保存
3. 设置视频URL
4. 等待用户加入

### 3.2 加入房间
1. 输入房间码验证
2. 建立WebSocket连接
3. 获取当前视频状态
4. 开始同步播放

### 3.3 同步控制
1. 用户操作触发事件
2. 发送WebSocket消息
3. 服务器广播给房间内其他用户
4. 接收方执行对应操作

## 4. 异常处理

### 4.1 房间异常
- 房间码无效提示
- 房间已满提示
- 视频源无效提示

### 4.2 连接异常  
- WebSocket断开提示
- 重新加载页面重连

## 5. 维护机制

### 5.1 房间清理
- 定时清理超过2小时的空房间
- 定时清理断开连接的用户

### 5.2 限制控制
- 最大房间数:1000
- 房间最大人数:2
- 视频大小限制:2GB

## 6. 后续优化方向
- 添加用户昵称
- 支持更多视频源
- 添加聊天功能
- 优化同步算法
- 添加房间密码